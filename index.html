<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ASMR Soundscape (No Sample Library)</title>
  <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
  <style>
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
      background: radial-gradient(circle at 30% 10%, #1b2230, #0b0f14 55%, #070a0e 100%);
      color:#e5e7eb;
      padding:24px;
    }
    .card{
      width:min(720px, 96vw);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:18px;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
    }
    h1{ margin:0 0 10px; font-size:18px; letter-spacing:.06em; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:12px; }
    button{
      padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08); color:#fff; cursor:pointer; font-weight:700;
    }
    button:disabled{ opacity:.45; cursor:not-allowed; }
    .ctrl{
      flex: 1 1 220px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      padding:12px;
    }
    label{ display:flex; justify-content:space-between; font-size:12px; color:rgba(229,231,235,.8); }
    input[type="range"]{ width:100%; margin-top:8px; }
    .hint{ margin-top:10px; font-size:12px; color:rgba(229,231,235,.72); line-height:1.5; }
    .badge{ font-size:12px; opacity:.75; }
  </style>
</head>
<body>
  <div class="card">
    <h1>簡易 ASMR 音景：黑膠 + 雨聲 + 隨機耳語（無音源庫）</h1>
    <div class="badge">Tone.js 合成｜建議戴耳機（左右耳擺動效果會更明顯）</div>

    <div class="row">
      <button id="startBtn">Start</button>
      <button id="stopBtn" disabled>Stop</button>
    </div>

    <div class="row">
      <div class="ctrl">
        <label><span>Vinyl（黑膠底噪）</span><span id="vinylVal">0.18</span></label>
        <input id="vinyl" type="range" min="0" max="0.6" step="0.01" value="0.18">
      </div>
      <div class="ctrl">
        <label><span>Rain（雨聲）</span><span id="rainVal">0.28</span></label>
        <input id="rain" type="range" min="0" max="0.9" step="0.01" value="0.28">
      </div>
      <div class="ctrl">
        <label><span>Whisper（耳語氣音）</span><span id="whisperVal">0.20</span></label>
        <input id="whisper" type="range" min="0" max="0.8" step="0.01" value="0.20">
      </div>
    </div>

    <div class="row">
      <div class="ctrl">
        <label><span>Warmth（溫暖度 / 濾波）</span><span id="warmVal">0.55</span></label>
        <input id="warm" type="range" min="0" max="1" step="0.01" value="0.55">
      </div>
      <div class="ctrl">
        <label><span>Space（空間感 / Reverb）</span><span id="spaceVal">0.35</span></label>
        <input id="space" type="range" min="0" max="0.75" step="0.01" value="0.35">
      </div>
      <div class="ctrl">
        <label><span>Motion（左右飄移）</span><span id="motionVal">0.45</span></label>
        <input id="motion" type="range" min="0" max="1" step="0.01" value="0.45">
      </div>
    </div>

    <div class="hint">
      這版「耳語」不是可辨識語句，而是<strong>耳語質感的氣音</strong>：帶通濾波 + 隨機音量包絡 + 左右聲道擺動。<br>
      你之後如果有耳語音檔（mp3/wav），我可以幫你做成「隨機抽取 + 近距離左右耳」的真正 ASMR 版本。
    </div>
  </div>

<script>
  // ===== UI helpers =====
  const $ = (id) => document.getElementById(id);
  function bindLabel(rangeId, labelId){
    const r = $(rangeId), l = $(labelId);
    l.textContent = Number(r.value).toFixed(2);
    r.addEventListener("input", () => l.textContent = Number(r.value).toFixed(2));
  }
  bindLabel("vinyl", "vinylVal");
  bindLabel("rain", "rainVal");
  bindLabel("whisper", "whisperVal");
  bindLabel("warm", "warmVal");
  bindLabel("space", "spaceVal");
  bindLabel("motion", "motionVal");

  // ===== Audio graph (created on Start) =====
  let started = false;

  let master, comp, toneLP, rev;
  let vinylNoise, vinylBP, vinylGain, vinylLfo;
  let rainNoise, rainHP, rainBP, rainGain, rainBurst;
  let whisperNoise, whisperBP1, whisperBP2, whisperGain, whisperEnv, whisperPan, whisperPanLfo;
  let motionPan, motionLfo;

  function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }
  function lerp(a,b,t){ return a + (b-a)*t; }

  async function start(){
    if(started) return;
    started = true;

    await Tone.start();

    // Master chain
    master = new Tone.Gain(0.85).toDestination();
    comp   = new Tone.Compressor(-22, 3).connect(master);

    // Warmth filter (will be controlled)
    toneLP = new Tone.Filter({ type:"lowpass", frequency: 4200, rolloff: -12, Q: 0.35 }).connect(comp);

    // Reverb (space)
    rev = new Tone.Reverb({ decay: 7.5, preDelay: 0.02, wet: 0.35 }).connect(toneLP);

    // Global motion (subtle stereo drift)
    motionPan = new Tone.Panner(0).connect(rev);
    motionLfo = new Tone.LFO({ frequency: 0.06, min: -0.35, max: 0.35 }).start();
    motionLfo.connect(motionPan.pan);

    // -------------------------
    // 1) Vinyl noise (pink + bandpass + slow flutter)
    // -------------------------
    vinylNoise = new Tone.Noise("pink");
    vinylBP = new Tone.Filter({ type:"bandpass", frequency: 1800, Q: 0.8 });
    const vinylHissLP = new Tone.Filter({ type:"lowpass", frequency: 5200, Q: 0.3 });

    vinylGain = new Tone.Gain(0.18).connect(motionPan);

    vinylNoise.connect(vinylBP);
    vinylBP.connect(vinylHissLP);
    vinylHissLP.connect(vinylGain);

    // subtle level flutter
    vinylLfo = new Tone.LFO({ frequency: 0.12, min: 0.10, max: 0.22 }).start();
    vinylLfo.connect(vinylGain.gain);

    // add tiny crackles via short noise bursts
    const crackle = new Tone.Noise("white");
    const crackleBP = new Tone.Filter({ type:"bandpass", frequency: 3200, Q: 2.5 });
    const crackleGain = new Tone.Gain(0.00).connect(motionPan);
    crackle.connect(crackleBP);
    crackleBP.connect(crackleGain);

    const crackleEnv = new Tone.AmplitudeEnvelope({
      attack: 0.001, decay: 0.02, sustain: 0.0, release: 0.03
    }).connect(crackleGain);

    crackle.start();

    // schedule crackles
    const crackleLoop = new Tone.Loop((time)=>{
      const prob = 0.35;
      if(Math.random() < prob){
        const amt = 0.02 + Math.random()*0.04;
        crackleGain.gain.setValueAtTime(amt, time);
        crackleEnv.triggerAttackRelease(0.05, time);
      }
    }, "8n").start(0);

    // -------------------------
    // 2) Rain (white noise shaped + random droplets)
    // -------------------------
    rainNoise = new Tone.Noise("white");

    // highpass to remove rumble, bandpass to shape "rain"
    rainHP = new Tone.Filter({ type:"highpass", frequency: 900, Q: 0.4 });
    rainBP = new Tone.Filter({ type:"bandpass", frequency: 3200, Q: 0.55 });

    rainGain = new Tone.Gain(0.28).connect(motionPan);

    rainNoise.connect(rainHP);
    rainHP.connect(rainBP);
    rainBP.connect(rainGain);

    // droplets: short bursts with random stereo micro-pan
    const drop = new Tone.Noise("white");
    const dropBP = new Tone.Filter({ type:"bandpass", frequency: 5200, Q: 1.2 });
    const dropEnv = new Tone.AmplitudeEnvelope({
      attack: 0.001, decay: 0.03, sustain: 0.0, release: 0.05
    });

    const dropPan = new Tone.Panner(0).connect(rev);
    const dropGain = new Tone.Gain(0.0).connect(dropEnv);
    drop.connect(dropBP);
    dropBP.connect(dropGain);
    dropEnv.connect(dropPan);
    drop.start();

    rainBurst = new Tone.Loop((time)=>{
      // density depends on rain level
      const level = Number($("rain").value);
      const density = lerp(0.25, 0.95, clamp(level/0.9, 0, 1));
      if(Math.random() < density){
        const pan = (Math.random()*2-1) * 0.6;
        dropPan.pan.setValueAtTime(pan, time);
        const amt = 0.01 + Math.random()*0.05 + level*0.03;
        dropGain.gain.setValueAtTime(amt, time);
        dropEnv.triggerAttackRelease(0.08, time);
      }
    }, "16n").start(0);

    // -------------------------
    // 3) Whisper-like texture (no sample): breath noise + formant-ish filters + random envelopes
    // -------------------------
    whisperNoise = new Tone.Noise("pink");

    // two bandpasses create a "vocal tract" vibe (formant-ish)
    whisperBP1 = new Tone.Filter({ type:"bandpass", frequency: 900, Q: 5.0 });
    whisperBP2 = new Tone.Filter({ type:"bandpass", frequency: 2400, Q: 7.0 });

    whisperEnv = new Tone.AmplitudeEnvelope({
      attack: 0.02, decay: 0.35, sustain: 0.0, release: 0.25
    });

    whisperGain = new Tone.Gain(0.20).connect(whisperEnv);

    // stereo panner dedicated to whisper (closer ASMR feel)
    whisperPan = new Tone.Panner(0).connect(rev);

    whisperNoise.connect(whisperBP1);
    whisperBP1.connect(whisperBP2);
    whisperBP2.connect(whisperGain);
    whisperEnv.connect(whisperPan);

    // whisper pan slow LFO
    whisperPanLfo = new Tone.LFO({ frequency: 0.09, min: -0.85, max: 0.85 }).start();
    whisperPanLfo.connect(whisperPan.pan);

    // random "ear whisper" events
    const whisperLoop = new Tone.Loop((time)=>{
      const level = Number($("whisper").value);
      const prob = lerp(0.08, 0.35, clamp(level/0.8,0,1));
      if(Math.random() < prob){
        // randomly shift formants
        const f1 = 650 + Math.random()*850;     // 650~1500
        const f2 = 1600 + Math.random()*1700;   // 1600~3300
        whisperBP1.frequency.setValueAtTime(f1, time);
        whisperBP2.frequency.setValueAtTime(f2, time);

        // vary event length
        const dur = 0.10 + Math.random()*0.40;

        // set gain amount (depends on level)
        const amt = (0.02 + Math.random()*0.10) * (0.6 + level);
        whisperGain.gain.setValueAtTime(amt, time);

        whisperEnv.triggerAttackRelease(dur, time);
      }
    }, "8n").start(0);

    // Start noises & transport
    vinylNoise.start();
    rainNoise.start();
    whisperNoise.start();

    Tone.Transport.start();

    // Hook UI controls
    applyAllControls();
    attachControlListeners();

    $("startBtn").disabled = true;
    $("stopBtn").disabled = false;
  }

  function stop(){
    if(!started) return;
    started = false;

    try{ Tone.Transport.stop(); Tone.Transport.cancel(); }catch(_){}

    // dispose everything
    const nodes = [
      master, comp, toneLP, rev,
      motionPan, motionLfo,

      vinylNoise, vinylBP, vinylGain, vinylLfo,
      rainNoise, rainHP, rainBP, rainGain, rainBurst,

      whisperNoise, whisperBP1, whisperBP2, whisperGain, whisperEnv, whisperPan, whisperPanLfo
    ];
    nodes.forEach(n => { try{ n && n.dispose(); }catch(_){ } });

    $("startBtn").disabled = false;
    $("stopBtn").disabled = true;
  }

  function applyAllControls(){
    // volumes
    if(vinylGain) vinylGain.gain.value = Number($("vinyl").value);
    if(rainGain)  rainGain.gain.value  = Number($("rain").value);
    if(whisperGain) whisperGain.gain.value = Number($("whisper").value);

    // warmth -> lowpass cutoff
    if(toneLP){
      const w = Number($("warm").value);
      const cutoff = lerp(2200, 8000, w);
      toneLP.frequency.rampTo(cutoff, 0.2);
    }

    // space -> reverb wet
    if(rev){
      const s = Number($("space").value);
      rev.wet.rampTo(s, 0.2);
    }

    // motion -> pan amount
    if(motionLfo){
      const m = Number($("motion").value);
      motionLfo.min = -0.35 * m;
      motionLfo.max =  0.35 * m;
    }
    if(whisperPanLfo){
      const m = Number($("motion").value);
      whisperPanLfo.min = -0.85 * m;
      whisperPanLfo.max =  0.85 * m;
    }
  }

  function attachControlListeners(){
    ["vinyl","rain","whisper","warm","space","motion"].forEach(id=>{
      $(id).addEventListener("input", applyAllControls);
    });
  }

  $("startBtn").addEventListener("click", start);
  $("stopBtn").addEventListener("click", stop);
</script>
</body>
</html>
